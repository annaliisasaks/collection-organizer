# Pull the Node image from Docker Hub
FROM node:14-slim
 
# Setting Working Directory
WORKDIR /app
ENV PATH /app/node_modules/.bin:$PATH
COPY . /app
RUN npm ci --loglevel verbose
 
ARG DB_HOST
ENV DB_HOST=${DB_HOST}
 
ARG DB_USER
ENV DB_USER=${DB_USER}
 
ARG DB_PASSWORD
ENV DB_PASSWORD=${DB_PASSWORD}
 
ARG DB_NAME
ENV DB_NAME=${DB_NAME}
 
ARG DB_PORT
ENV DB_PORT=${DB_PORT}
 
ARG SERVER_PORT
ENV SERVER_PORT=${SERVER_PORT}
 
ARG LOGIN_EMAIL_WHITELIST
ENV LOGIN_EMAIL_WHITELIST=${LOGIN_EMAIL_WHITELIST}
 
ARG OAUTH_CLIENT_ID
ENV OAUTH_CLIENT_ID=${OAUTH_CLIENT_ID}
 
ARG OAUTH_CLIENT_SECRET
ENV OAUTH_CLIENT_SECRET=${OAUTH_CLIENT_SECRET}
 
ARG JWT_SECRET
ENV JWT_SECRET=${JWT_SECRET}
 
ARG S3_ID
ENV S3_ID=${S3_ID}
 
ARG S3_SECRET
ENV S3_SECRET=${S3_SECRET}
 
ARG S3_BUCKET_NAME
ENV S3_BUCKET_NAME=${S3_BUCKET_NAME}
 
EXPOSE 80
 
# Run the API on Nodemon
CMD ["npm", "run", "dev"]
